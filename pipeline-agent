pipeline {
    agent any 
    environment {
        NAME = "ganesh"
        GIT_URL = "https://github.com/ganesh-redy/jenkins-stash-agent.git"
        DIR = "jenkins-stash-agent"
    }
    stages {
        stage("mvn clean") {
            steps {
                sh ''' 
                    mvn clean install
                '''
                stash includes: 'target/*.jar', name: 'myjar'
            }
        }

        stage("Build Docker Image") {
            agent {
                label 'agent'
            }
            steps {
                unstash 'myjar'
                sh ''' 
                    git clone ${GIT_URL}
                    cp ${DIR}/Dockerfile .
                    docker build -t java1 .
                '''
            }
        }
    }
}
