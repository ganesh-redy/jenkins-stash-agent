pipeline {
    agent any 
    environment {
        NAME = "ganesh"
        GIT_URL = "https://github.com/ganesh-redy/jenkins-stash-agent.git"
        DIR = "jenkins-stash-agent"
    }
    stages {
        stage("mvn clean") {
            steps {
                sh ''' 
                    mvn clean install
                    cp target/simple-java-maven-app-1.0-SNAPSHOT.jar .
                 '''
                stash includes: 'simple-java-maven-app-1.0-SNAPSHOT.jar', name: 'myjar'
            }
        }
         stage("check path ") {
                    agent {
                        label 'agent'
                    }
                    steps {
                        
                        sh ''' 
                            pwd
                             ls
        
                        '''
                    }
                }

        stage("Build Docker Image") {
            agent {
                label 'agent'
            }
            steps {
                unstash 'myjar'
                sh ''' 
                    git clone ${GIT_URL}
                     ls

                    cp ${DIR}/Dockerfile .
                    docker build -t java1 .
                '''
            }
        }
    }
}
